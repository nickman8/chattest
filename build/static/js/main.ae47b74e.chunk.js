(this.webpackJsonpchat=this.webpackJsonpchat||[]).push([[0],{131:function(e,t,a){e.exports=a(203)},136:function(e,t,a){},137:function(e,t,a){},138:function(e,t,a){},150:function(e,t,a){},151:function(e,t,a){},152:function(e,t,a){},153:function(e,t,a){},170:function(e,t,a){},171:function(e,t,a){},200:function(e,t){},203:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),s=a(8),r=a.n(s),c=(a(136),a(114)),l=a(42),i=(a(137),a(34)),m=a(35),u=a(39),p=a(37),d=a(251),h=(a(138),a(63)),g=(a(139),a(237)),f=a(253),v=a(106),b=a.n(v),y=a(107),E=a.n(y),k=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this)).name=e.name,n.messages=e.messages,n.id=e.id(),n}return Object(m.a)(a,[{key:"sendMessageToState",value:function(e){e?this.props.addToMessageArray({name:this.props.name,text:this.props.message.text,img:this.props.message.img,id:this.id}):this.props.deleteMessageFromState({name:this.props.name,text:this.props.message.text,id:this.id})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:this.props.clientName==this.name?"message flex-end":"message flex-start"},console.log(this.props),console.log(this.name),o.a.createElement("div",{className:this.props.clientName==this.name?"my-chat-message":"chat-message"},"ADMIN"===this.name?o.a.createElement("strong",null," ",o.a.createElement("span",null,this.name,": ")," "):o.a.createElement("span",{className:"chat-name"},this.name,": "),"ADMIN"===this.name?o.a.createElement("strong",null," ",o.a.createElement("span",null,"\xa0 ",this.props.message.text," ")," "):o.a.createElement("span",{className:"chat-text"},"\xa0 ",this.props.message.text," "),!this.props.chooseMod&&o.a.createElement("img",{onClick:function(){return e.props.setForwardOn(e.name,e.props.message.text,e.props.message.img)},className:"forward-arrow",src:"./forward-arrow.png"}),!this.props.chooseMod&&o.a.createElement("img",{onClick:this.props.SetChooseMod,className:"forward-arrow",src:"./384288-200.png"}),this.props.chooseMod&&o.a.createElement(g.a,{control:o.a.createElement(f.a,{className:"chat-message-checkbox",icon:o.a.createElement(b.a,{fontSize:"small"}),checkedIcon:o.a.createElement(E.a,{fontSize:"small"}),name:"checkedI",onClick:function(t){e.sendMessageToState(t.target.checked)}})}),this.props.chooseMod&&o.a.createElement("img",{onClick:this.props.SetChooseMod,className:"cancel-button",src:"./cancel.png"})),0!=Object.entries(this.props.message.img).length?o.a.createElement("div",null," ",o.a.createElement("i",null,"\u041f\u0440\u0438\u043a\u0440\u0435\u043f\u043b\u0435\u043d\u043d\u044b\u0435 \u0444\u0430\u0439\u043b\u044b:")," "):"",o.a.createElement("div",{className:"flex"},0!=Object.entries(this.props.message.img).length?this.props.message.img.map((function(e){return o.a.createElement(h.a,null,o.a.createElement("img",{key:e.id,className:"img",src:e.image.path,alt:"ChatImage"}))})):""),0!=this.props.message.quote.length?this.props.message.quote.map((function(e){return o.a.createElement("div",{className:"quote"},o.a.createElement("div",null,o.a.createElement("span",{className:"quote-title"},"Quoted post: "),o.a.createElement("span",{className:"quote-name"}," Name: ",e.name," "),o.a.createElement("span",{className:"quote-text"}," ",e.text," ")),0!=Object.entries(e.img).length?e.img.map((function(e){return o.a.createElement(h.a,null,o.a.createElement("img",{key:e.id,className:"img",src:e.image.path,alt:"ChatImage"}))})):"")})):"")}}]),a}(o.a.Component),O=a(16),N=(a(150),a(21)),M=a(38),S=Object(M.b)({name:"socket",initialState:{clientName:"",messages:[],roomListArray:[],token:localStorage.getItem("token"),socketUrl:"http://localhost:3001"},reducers:{roomList:function(e,t){t.payload.list.forEach((function(t){e.roomListArray.push(t)})),e.roomListArray=Array.from(new Set(e.roomListArray))},newUserConnected:function(e,t){e.messages.push({name:"ADMIN",id:Date.now(),message:{text:"".concat(t.payload.clientName," joined the chat"),img:{},quote:[]}})},sendMsg:function(e,t){},accept:function(e,t){return e=Object(N.a)(Object(N.a)({},e),{},{clientName:t.payload.clientName}),e=Object(N.a)(Object(N.a)({},e),{},{token:t.payload.token}),localStorage.setItem("token",t.payload.token),localStorage.setItem("clientName",t.payload.clientName),e},OnAuth:function(e,t){(e=Object(N.a)(Object(N.a)({},e),{},{token:t.payload.token})).token=t.payload.token},OffAuth:function(e,t){e=Object(N.a)(Object(N.a)({},e),{},{token:""})},auth:function(e,t){},userDisconnected:function(e,t){e.roomListArray=e.roomListArray.filter((function(e,a){return e!=t.payload.clientName})),e.messages.push({name:"ADMIN",id:Date.now(),message:{text:"".concat(t.payload.clientName," left the chat"),img:{},quote:[]}})},newMsg:function(e,t){e.messages.push({name:t.payload.clientName,id:Date.now(),message:t.payload.msg})}}}),j=S.actions,w=j.sendMsg,C=j.OnAuth,x=j.OffAuth,A=j.auth,D=S.reducer;a(151);var I=function(e){return console.log(e.oneMessage),o.a.createElement("div",{className:"preview "},o.a.createElement("div",null,o.a.createElement("h4",{className:"quoted-title"},"Quoted message from ",e.oneMessage.name),o.a.createElement("span",{className:"preview-text"}," ",e.oneMessage.text)),0!=e.oneMessage.img.length&&o.a.createElement("div",{className:"preview-counter"},e.oneMessage.img.length),o.a.createElement("img",{onClick:e.setForwardOff,className:"preview-close",src:"./close.png"}))};a(152);var q=function(e){return o.a.createElement("div",null,o.a.createElement("div",{className:"preview-counter forward-counter"},e.length))},F={bgcolor:"background.paper",border:1,style:{height:"25rem"},overflow:"auto"},T=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).ref=o.a.createRef(),n.scroll=o.a.createRef(),n.toTop=function(){var e=document.querySelector(".MuiBox-root");e.scrollTop=e.scrollHeight},n.state={quote:"false"},n}return Object(m.a)(a,[{key:"componentDidMount",value:function(){localStorage.getItem("token")&&this.props.auth()}},{key:"componentDidUpdate",value:function(){}},{key:"getDate",value:function(){return Date.now().toString()}},{key:"render",value:function(){var e=this;return o.a.createElement("div",null,o.a.createElement(d.a,Object.assign({className:"chat-box",ref:this.myRef,borderColor:"primary.main"},F),o.a.createElement("div",null,this.props.messages.messages.map((function(t){return o.a.createElement(k,{SetChooseMod:e.props.SetChooseMod,chooseMod:e.props.chooseMod,addToMessageArray:e.props.addToMessageArray,key:t.id,name:t.name,message:t.message,setForwardOn:e.props.setForwardOn,setForwardOff:e.props.setForwardOff,deleteMessageFromState:e.props.deleteMessageFromState,id:e.getDate,clientName:e.props.clientName})})))),0!=this.props.messagesArray.length&&o.a.createElement(q,{length:this.props.messagesArray.length}),this.props.forward?o.a.createElement(I,{setForwardOff:this.props.setForwardOff,oneMessage:this.props.oneMessage}):" ")}}]),a}(o.a.Component),L=Object(O.b)((function(e){return console.log(),{messages:e.socket,clientName:e.socket.clientName}}),(function(e){return{auth:function(){e(A())}}}))(T),U=a(249),z=a(242),H=a(243),B=a(112),R=a.n(B),J=a(240),Q=a(254),P=a(247),W=a(245),Y=a(246),G=a(244),K=(a(153),a(111)),V=a.n(K),X=a(110),Z=a.n(X),$=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).name="nameless",n.changeName=e.changeName,n.open=!1,n.formName=n.name,n.state={value:"",name:"nameless",formName:"nameless",disabled:!1},n}return Object(m.a)(a,[{key:"getnick",value:function(){}},{key:"delete",value:function(){localStorage.removeItem("token"),localStorage.removeItem("clientName"),window.location.reload(!1)}},{key:"handleClickOpen",value:function(){this.formName=this.state.name,this.open=!0,this.forceUpdate()}},{key:"handleCloseSubmit",value:function(){this.open=!1,""!==this.state.formName&&this.setState({name:this.state.formName}),this.forceUpdate()}},{key:"handleClose",value:function(){this.open=!1,this.forceUpdate()}},{key:"getLoad",value:function(){return 0==this.state.loading?"disabled":null}},{key:"sumbitHandler",value:function(e,t){var a=this;if(""!=this.state.value){var n=document.querySelector(".MuiBox-root");setTimeout((function(){n.scrollTop=n.scrollHeight}),100),e.preventDefault(),this.setState({value:""});var o=document.querySelector('input[type="file"]').files[0],s=this.state.value,r=this.props.addMessage,c=this.props.oneMessage,l=[],i=this.props.messagesArray,m=new FormData;if(Array.from(document.querySelector('input[type="file"]').files).forEach((function(e){m.append("picture",e)})),void 0!=o&&(this.setState({disabled:!0}),Z.a.post("https://nest-zuz.herokuapp.com/pictures/upload",m,{headers:{"Content-Type":"multipart/form-data"}}).then((function(e){console.log(e.data),e.data.forEach((function(e){l.push({path:e.path})})),console.log(l);var t=[];c&&t.push(c),i&&(t=i),r(s,{image:l},t),setTimeout((function(){n.scrollTop=n.scrollHeight}),100),console.log("SUCCESS!!")})).catch((function(e){console.log(e)})).finally((function(){a.setState({disabled:!1})}))),void 0==o){var u=[];c&&u.push(c),0!=Object.keys(i).length&&(console.log("ya tut"),u=i),this.props.addMessage(this.state.value,{},u)}document.querySelector('input[type="file"]').value=""}else e.preventDefault(),alert("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0442\u0435\u043a\u0441\u0442");this.props.forwardOff(),this.props.chooseMod&&this.props.SetChooseMod(),this.props.clearMessages()}},{key:"render",value:function(){var e=this;return o.a.createElement("form",{id:"send",className:"flex",onSubmit:this.sumbitHandler.bind(this)},o.a.createElement(U.a,{id:"standard-multiline-flexible",label:"Your message",className:"root",value:this.state.value,onChange:function(t){return e.setState({value:t.target.value})}}),o.a.createElement("input",{accept:"image/*",className:"input",id:"icon-button-file",type:"file",multiple:!0}),o.a.createElement("label",{htmlFor:"icon-button-file"},o.a.createElement(J.a,{color:"primary","aria-label":"upload picture",component:"span"},o.a.createElement(V.a,null))),o.a.createElement(z.a,Object.assign({variant:"contained",color:"primary",type:"sumbit",className:"button"},this.state.disabled,{endIcon:o.a.createElement(H.a,null,"send")}),"Send"),o.a.createElement(J.a,{color:"primary",onClick:this.handleClickOpen.bind(this)},o.a.createElement(R.a,{color:"primary"})),o.a.createElement(Q.a,{open:this.open,onClose:this.handleClose.bind(this),"aria-labelledby":"form-dialog-title"},o.a.createElement(G.a,{id:"form-dialog-title"},"Settings"),o.a.createElement(W.a,null,o.a.createElement(Y.a,null),o.a.createElement(z.a,{onClick:this.delete,variant:"contained",color:"secondary"},"Delete token")),o.a.createElement(P.a,null,o.a.createElement(z.a,{onClick:this.handleClose.bind(this),color:"primary"},"Cancel"))))}}]),a}(o.a.Component),_=Object(O.b)((function(e){return{messages:e.messages}}),(function(e){return{addMessage:function(t,a,n){e(w({text:t,img:a,quote:n}))}}}))($),ee=a(248);a(170);var te=Object(O.b)((function(e){return{socket:e.socket.roomListArray,message:e.socket.messages}}))((function(e){function t(){var e=.5+1e9*Math.random();return Math.round(e)}return o.a.createElement("div",{className:"online"},o.a.createElement("h2",null,"People online:"),e.socket.map((function(e){return o.a.createElement("div",{key:t()},e)})))}));a(171);var ae=Object(O.b)((function(e){return{auth:e.token}}))((function(e){var t=e.storageFunc;return console.log(t),o.a.createElement("div",null,o.a.createElement("h1",{style:{textAlign:"center"}},"Welcome")," ",o.a.createElement(z.a,{className:"button-reg",onClick:t,variant:"contained",color:"secondary"}," ","Sign In")," ")}));var ne=Object(O.b)((function(e){return{token:e.socket.token,url:e.socket.socketUrl}}),(function(e){return{OnAuth:function(t){e(C(t))},OffAuth:function(){e(x())},auth:function(){e(A())}}}))((function(e){var t=Object(n.useState)(null!==localStorage.getItem("token")),a=Object(l.a)(t,2),s=a[0],r=a[1],i=Object(n.useState)(!1),m=Object(l.a)(i,2),u=m[0],p=m[1],d=Object(n.useState)(),h=Object(l.a)(d,2),g=h[0],f=h[1],v=Object(n.useState)(!1),b=Object(l.a)(v,2),y=b[0],E=b[1],k=Object(n.useState)([]),O=Object(l.a)(k,2),N=O[0],M=O[1];function S(){p(!1),f()}function j(){E(1!=y)}return o.a.createElement(ee.a,null,s?o.a.createElement("div",{className:"flex relative"},o.a.createElement("div",null,o.a.createElement(te,null)),o.a.createElement("div",{style:{width:"100%"}},o.a.createElement("h1",{style:{textAlign:"center"}},"ChatApp"),o.a.createElement(L,{forward:u,setForwardOn:function(e,t,a){p(!0),f({name:e,text:t,img:a}),console.log(e),console.log(t)},setForwardOff:S,oneMessage:g,chooseMod:y,SetChooseMod:j,addToMessageArray:function(e){M((function(t){return[].concat(Object(c.a)(t),[e])}))},deleteMessageFromState:function(e){console.log(N),console.log(e);var t=N.filter((function(t){return!(t.id===e.id)}));M(t)},messagesArray:N}),o.a.createElement(_,{messagesArray:N,oneMessage:g,forwardOff:S,chooseMod:y,SetChooseMod:j,clearMessages:function(){M([])}}))):o.a.createElement(ae,{storageFunc:function(){e.auth(),r(!0)}}))})),oe=Object(M.b)({name:"messages",initialState:[{id:1,name:"Andrew",message:"hi"},{id:2,name:"Den",message:"hello"},{id:3,name:"Alex",message:"Nice to meet you"}],reducers:{addMessage:function(e,t){e.push({name:t.payload.name,id:Date.now(),message:t.payload.message})}}}),se=(oe.actions.addMessage,oe.reducer);var re=a(113),ce=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=(a.execute,arguments.length>3&&void 0!==arguments[3]?arguments[3]:["roomList","connected","newUserConnected","userDisconnected","newMsg","accept"]);return e.emit.bind(e),function(a){var o=a.dispatch,s=a.getState;return n.map((function(a){e.on(a,(function(e){o({type:t+a,payload:e})}))})),function(t){return function(a){if("socket/sendMsg"===a.type){var n=a.payload.text,o=a.payload.img.image,r=[],c=a.payload.quote,l=s().socket.token,i=s().socket.clientName;o&&o.forEach((function(e){r.push({id:Math.round(.5+1e9*Math.random()),image:e})})),e.emit("sendMsg",{text:n,img:r,token:l,clientName:i,quote:c})}if("socket/auth"===a.type){var m=localStorage.getItem("token"),u=localStorage.getItem("clientName");null!==m&null!==u?e.emit("auth",{token:m,clientName:u}):e.emit("auth")}return t(a)}}}}(a.n(re)()("https://nest-zuz.herokuapp.com/"),"socket/"),le=Object(M.a)({reducer:{messages:se,socket:D},middleware:function(e){return e().concat(ce)}});le.subscribe((function(){}));var ie=le;r.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(O.a,{store:ie},o.a.createElement(ne,null))),document.getElementById("root"))}},[[131,1,2]]]);
//# sourceMappingURL=main.ae47b74e.chunk.js.map